// prisma/schema.prisma
// 1. Prisma Schema Example
// ‡∏£‡∏±‡∏ô `npx prisma migrate dev --name init` ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id  String  @id @default(uuid()) @map("user_id")
  username String  @unique
  password String
  name     String
  role     String
  image_url String?   // üëà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ (optional)
  sales    Sale[]
  stock_changes StockTransaction[]
}


model Category {
  category_id   String   @id             // ‚ùå ‡∏ï‡∏±‡∏î @default(uuid()) ‡∏ó‡∏¥‡πâ‡∏á
  category_name String   @unique         // ‚úÖ ‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ
  products      Product[]
}

enum ProductStatus {
  AVAILABLE      // ‡∏°‡∏µ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢
  OUT_OF_STOCK   // ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á active
  UNAVAILABLE    // ‡πÄ‡∏•‡∏¥‡∏Å‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß
}

model Product {
  product_id   String   @id
  product_name String
  category_id  String
  barcode      String?  @unique
  cost_price   Float
  sell_price   Float
  unit         String
  stock_qty    Int      @default(0)
  status       ProductStatus @default(AVAILABLE)

  category     Category @relation(fields: [category_id], references: [category_id])
  sale_items   SaleItem[]
  stock_transactions StockTransaction[]
}


model Sale {
  sale_id        String   @id
  user_id        String?
  user           User?    @relation(fields: [user_id], references: [user_id])
  payment_method String   @default("‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î")
  cash_received  Float?
  vat_rate       Float    @default(0)
  sub_total      Float    @default(0)
  vat_amount     Float    @default(0)
  grand_total    Float    @default(0)

  // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô timestamptz (UTC) ‡∏à‡∏∞‡∏ô‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
  created_at     DateTime @db.Timestamptz(6) @default(now())

  items          SaleItem[]
}


model SaleItem {
  sale_item_id String  @id @default(cuid())   // ‚úÖ ‡πÉ‡∏´‡πâ Prisma gen id ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  sale_id      String
  sale         Sale    @relation(fields: [sale_id], references: [sale_id])
  product_id   String
  product      Product @relation(fields: [product_id], references: [product_id])
  quantity     Int
  price        Float
  total        Float   @default(0)
}


model StockTransaction {
  stock_id String   @id @default(uuid()) @map("stock_id")
  product_id String
  change_type String
  quantity Int
  note     String?
  timestamp DateTime @default(now())
   // ‚≠ê ‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ó‡∏≥
  user_id     String?  @map("user_id")
  user        User?    @relation(fields: [user_id], references: [user_id])

  product     Product  @relation(fields: [product_id], references: [product_id])
}

model Expense {
  expense_id String   @id @default(uuid()) @map("expense_id")
  expense_name String
  amount       Float
  expense_date DateTime @default(now())
  note         String?
}

model Setting {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String
}

